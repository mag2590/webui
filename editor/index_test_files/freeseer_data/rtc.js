if(typeof exports=="undefined")var exports=this.mymodule={};exports.handleClientMessage_CUSTOM=function(a,b,c){var d=b.payload.action,e=b.payload.padId,f=b.payload.targetAuthorId,g=b.payload.authorId;if(d==="requestRTC"){var h=escape(b.payload.authorName),i="<form class='ep_rtc_form'><input type=button class='#ep_rtc_accept' data-targetAuthorId='"+f+"' data-padId='"+e+"' data-myAuthorId='"+g+"' value='Accept' onClick='etherpadRTC.acceptReq(this);'><input type=button class='#ep_rtc_decline' value='Decline' onClick='etherpadRTC.declineReq(this)'></form>";$.gritter.add({title:h+" would like to create a peer connection with you.",text:"Peer connections are used for Video, audio and file sharing.  You should only accept if you trust this person"+i,sticky:!1,time:2e4})}};var etherpadRTC={init:function(){this.listeners(),$("#localVideo").length===0&&$('<div id="localVideo"></div><div id="remotesVideos"></div><div id="hangUp">End Call</div><div id="progressIndicator"></div>').insertBefore("#chattext")},sendRequest:function(a){var b=$(a).parent().find(".usertdname").text(),c=$(a).data("type"),d=$(a).parent().data("authorid"),e=pad.getUserId(),f=pad.getPadId();etherpadRTC.displayVideoChat(),etherpadRTC.createRTC(d);var g={type:"RTC",action:"requestRTC",padId:f,targetAuthorId:d,myAuthorId:e};pad.collabClient.sendMessage(g),padeditbar.toggleDropDown()},createRTC:function(a){var b=pad.getPadId(),c=b+"--EP--"+a;c=encodeURIComponent(c),exports.webrtc=new WebRTC({localVideoEl:"localVideo",remoteVideosEl:"remotesVideos",autoRequestMedia:!0}),exports.webrtc.on("ready",function(){$("#permissionHelper").show(),$("#progressIndicator").show(),$("#hangUp").show(),$("#hangUp").click(function(){$("#hangUp").hide(),exports.webrtc.hangUp()})}),exports.webrtc.hangUp=function(){$("#hangUp").hide()},exports.webrtc.on("readyToCall",function(){$("#permissionHelper").hide(),$("#progressIndicator").hide(),exports.webrtc.joinRoom(c)})},hangUp:function(){webrtc.leaveRooms(),etherpadRTC.hideVideoChat()},displayVideoChat:function(){chat.stickToScreen(!0),$("#chattext").css({top:"150px"})},hideVideoChat:function(){chat.stickToScreen(!1),$("#chattext").css({top:"10px"})},listeners:function(a){$("#otheruserstable").on("click",".usertdname",function(){etherpadRTC.appendCallOptions(this)}),$("#otheruserstable").on("click",".callOptions",function(){etherpadRTC.sendRequest(this)})},appendCallOptions:function(a){$(".callOptions").remove(),$(a).parent().append("<td data-type='video' class='videoCall callOptions' title='Video call this author'>V</td>")},acceptReq:function(a){var b=$(a).data("padid"),c=$(a).data("myauthorid"),d=$(a).data("targetauthorid"),e={padId:b,myAuthorId:c,targetAuthorId:d};$.gritter.removeAll,etherpadRTC.displayVideoChat(),etherpadRTC.createRTC(e.targetAuthorId)},declineReq:function(a){var b=$(a).data("padid"),c=$(a).data("myauthorid"),d=$(a).data("targetauthorid"),e={type:"RTC",action:"declineRTC",padId:b,targetAuthorId:c,myAuthorId:d};pad.collabClient.sendMessage(e),$.gritter.removeAll()}}